<html>
<head>
  <script src="../../lib/Jugl.js"></script>
  <script type="text/javascript">

    function test_Template_constructor(t) {
        t.plan(6);
        
        // import
        var uri = "http://jugl.tschaub.net/trunk/lib/Jugl.js";
        var Jugl = window[uri];

        // create a new template
        var template = new Jugl.Template();
        
        // no template id provided, template should not be loaded
        t.ok(!template.loaded, "template not loaded if no id given");
        
        // create template with bad id
        var error;
        try {
            template = new Jugl.Template("bogus");
        } catch(err) {
            error = err;
        }
        t.ok(error instanceof Error, "error thrown for bogus template id");
        
        // create valid template
        template = new Jugl.Template("template1");
        t.eq(template.loaded, true, "valid id template sets loaded");
        t.eq(template.element.nodeType, 1, "valid id template sets element");
        
        // alternatively, create a template with a dom element
        var element = document.getElementById("template1");
        template = new Jugl.Template(element);
        t.eq(template.loaded, true, "element template sets loaded");
        t.ok(template.element == element, "element template sets element"); 
    }

    function test_Template_process(t) {
        t.plan(4);
        
        // import
        var uri = "http://jugl.tschaub.net/trunk/lib/Jugl.js";
        var Jugl = window[uri];
        
        // test template.process
        var realProcess = Jugl.Node.prototype.process;
        Jugl.Node.prototype.process = function() {
            this.element = "processed";
        };
        var template = new Jugl.Template('template1');
        var data = template.process();
        t.eq(data, "processed", "template.process returns template.element");

        // test template.process with context
        Jugl.Node.prototype.process = function() {
            this.element = this.scope;
        };
        var scope = {
            foo: "bar"
        };
        data = template.process(scope);
        t.eq(data, scope, "template process with scope sets node.scope");

        Jugl.Node.prototype.process = realProcess;
        
        // test template.process with clone
        var realClone = Jugl.Node.prototype.clone;
        Jugl.Node.prototype.clone = function() {
            return {
                element: "cloned",
                process: function() {}
            };
        };
        template = new Jugl.Template('template1');
        data = template.process(null, true);
        t.eq(data, "cloned", "clone true calls node.clone");
        Jugl.Node.prototype.clone = realClone;
        
        // test template.process with toString
        var template = new Jugl.Template('template1');
        window.testContent = "foo";
        var data = template.process(null, false, true);
        t.eq(
            data.replace(/^\s+|\s+$/g, ''), "<p>foo<"+"/p>",
            "node processed to string"
        );
    }

  </script>
</head>
<body>
    <div id="template1">
        <p jugl:content="testContent">replace this content</p>
    </div>
</body>
</html>
